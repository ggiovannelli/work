#!/bin/sh
# tar-xxd-sfx - Simplified Unix version

# Check parameters
if [ $# -eq 0 ] || [ "$1" = "-h" ]; then
    echo "Usage: $0 [-u|-w|-d] files..."
    echo "  -u  Unix/Linux output (default)"
    echo "  -w  Windows output (with xxd)"
    echo "  -d  Dual platform output"
    exit 0
fi

# Check for xxd
if ! command -v xxd >/dev/null 2>&1; then
    echo "Error: xxd not found. Please install xxd."
    exit 1
fi

# Set defaults
T="unix"
F="$@"

# Check for options
case "$1" in
    -u) T="unix"; shift; F="$@" ;;
    -w) T="windows"; shift; F="$@" ;;
    -d) T="dual"; shift; F="$@" ;;
    *) T="unix"; F="$@" ;;
esac

# Create temp files
G="/tmp/a$$.gz"
H="/tmp/a$$.hex"

# Show header
echo ": $(date '+%Y.%m.%d-%H:%M:%S') $(hostname) $F"
echo

# Create archive
tar -czf "$G" $F 2>/dev/null
xxd -p -c 9999 "$G" > "$H"

# Output based on type
if [ "$T" != "windows" ]; then
    echo ": For Unix/Linux:"
    echo "( xxd -p -r | tar -zxvf - ) <<EOF"
    xxd -p -c 56 "$G"
    echo "EOF"
fi

[ "$T" = "dual" ] && echo && echo

if [ "$T" != "unix" ]; then
    echo ": For Windows with xxd:"
    echo "echo $(cat "$H") | xxd -p -r | tar -zxvf -"
fi

# Cleanup
rm -f "$G" "$H"
